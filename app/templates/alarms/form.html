{% extends "_base.html" %}
{% block content %}
<h1 class="text-2xl font-bold mb-3">{{ 'Edit Alarm' if rule else 'New Alarm' }}</h1>
<form method="post" class="bg-white p-4 rounded shadow grid gap-3 max-w-xl">
  <label>Site
    <select name="site_id" class="border p-2 w-full" required>
      {% for s in sites %}
        <option value="{{s.id}}" {% if rule and rule.site_id==s.id %}selected{% endif %}>{{ s.name }}</option>
      {% endfor %}
    </select>
  </label>
  <label>Type
    <select name="rule_type" class="border p-2 w-full" required>
      {% set t = rule.rule_type if rule else '' %}
      <option value="no_data"  {% if t=='no_data' %}selected{% endif %}>No data</option>
      <option value="low_prod" {% if t=='low_prod' %}selected{% endif %}>Low production</option>
    </select>
  </label>
  <label>No-data minutes (for no_data)
    <input class="border p-2 w-full" name="minutes_no_data" type="number" min="5" step="5"
           value="{{ rule.minutes_no_data if rule else 60 }}">
  </label>
  <label>Expected kWh/kWp (for low_prod)
    <input class="border p-2 w-full" name="expect_kwh_per_kwp" type="number" step="0.1"
           value="{{ rule.expect_kwh_per_kwp if rule else 3.5 }}">
  </label>
  <label>Email to (optional override)
    <input class="border p-2 w-full" name="email_to" value="{{ rule.email_to if rule else '' }}">
  </label>
  <label class="flex items-center gap-2">
    <input type="checkbox" name="is_active" {% if not rule or rule.is_active %}checked{% endif %}> Active
  </label>
  <button class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
</form>
{% endblock %}
